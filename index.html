<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity KSA Generator Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .table-container {
            overflow-x: auto;
        }
        th, td {
            min-width: 150px;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #06b6d4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-cyan-400">Cybersecurity KSA Generator</h1>
            <p class="text-lg md:text-xl text-gray-400 mt-2">Live Demonstration</p>
        </header>

        <main>
            <!-- API Key Screen (Visible by default) -->
            <div id="api-key-screen" class="max-w-xl mx-auto text-center">
                <div class="bg-gray-800 rounded-lg shadow-lg p-8">
                    <label for="api-key-input" class="block text-xl font-medium text-gray-300 mb-3">Enter Your API Key</label>
                    <p class="text-sm text-gray-500 mb-4">
                        You need an API key to use this demo.
                    </p>
                    <input type="password" id="api-key-input" class="w-full bg-gray-700 border border-gray-600 rounded-md px-4 py-2 text-white placeholder-gray-400 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition" placeholder="Paste your API key here">
                    <button id="save-key-btn" class="mt-6 bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-8 rounded-md transition duration-300 ease-in-out transform hover:scale-105 shadow-md">
                        Continue
                    </button>
                     <p id="api-key-error" class="text-red-400 text-sm mt-3 hidden">Please enter a valid API key.</p>
                </div>
            </div>

            <!-- Main App Screen (Hidden by default) -->
            <div id="main-app-screen" class="hidden">
                <!-- Input Section -->
                <div class="bg-gray-800 rounded-lg shadow-lg p-6 mb-8 max-w-3xl mx-auto">
                    <!-- Ability Input -->
                    <label for="ability-input" class="block text-lg font-medium text-gray-300 mb-2">Enter a Cybersecurity Ability:</label>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="ability-input" class="w-full bg-gray-700 border border-gray-600 rounded-md px-4 py-2 text-white placeholder-gray-400 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition" placeholder="e.g., Perform vulnerability scanning">
                        <button id="generate-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-6 rounded-md transition duration-300 ease-in-out transform hover:scale-105 shadow-md disabled:bg-gray-500 disabled:scale-100 disabled:cursor-not-allowed flex items-center justify-center">
                            <span id="btn-text">Generate</span>
                            <div id="btn-loader" class="loader w-5 h-5 border-2 border-t-2 hidden ml-2"></div>
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="results-container" class="bg-gray-800 rounded-lg shadow-2xl p-4 md:p-6">
                     <div id="loader" class="flex justify-center py-12 hidden">
                        <div class="loader"></div>
                     </div>
                     <div id="error-container" class="text-center py-12 text-red-400 hidden">
                        <p class="text-xl">An error occurred.</p>
                        <p id="error-message" class="text-sm text-gray-500 mt-2"></p>
                     </div>
                     <h2 id="table-title" class="text-2xl font-bold text-white mb-4 text-center hidden"></h2>
                     <div id="table-wrapper" class="table-container hidden">
                        <table class="w-full text-sm text-left text-gray-300">
                            <thead class="text-xs text-cyan-300 uppercase bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Discipline</th>
                                    <th scope="col" class="px-6 py-3">Level</th>
                                    <th scope="col" class="px-6 py-3">Role</th>
                                    <th scope="col" class="px-6 py-3">Knowledge</th>
                                    <th scope="col" class="px-6 py-3">Skill</th>
                                    <th scope="col" class="px-6 py-3">Training Source</th>
                                    <th scope="col" class="px-6 py-3">Training Link</th>
                                    <th scope="col" class="px-6 py-3">Technical Stack</th>
                                    <th scope="col" class="px-6 py-3">Description</th>
                                    <th scope="col" class="px-6 py-3">Demonstration</th>
                                </tr>
                            </thead>
                            <tbody id="ksa-table-body"></tbody>
                        </table>
                    </div>
                    <div id="no-results" class="text-center py-12 text-gray-500">
                        <p class="text-xl">Enter an ability and click "Generate" to see the results.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Screen and button selectors
        const apiKeyScreen = document.getElementById('api-key-screen');
        const mainAppScreen = document.getElementById('main-app-screen');
        const saveKeyBtn = document.getElementById('save-key-btn');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiKeyError = document.getElementById('api-key-error');

        // Main app selectors
        const generateBtn = document.getElementById('generate-btn');
        const abilityInput = document.getElementById('ability-input');
        const tableBody = document.getElementById('ksa-table-body');
        const tableTitle = document.getElementById('table-title');
        const noResultsDiv = document.getElementById('no-results');
        const tableWrapper = document.getElementById('table-wrapper');
        const mainLoader = document.getElementById('loader');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        
        let userApiKey = ''; // To store the key after validation

        // Schema definition for the structured response
        const ksaSchema = {
            type: "ARRAY",
            items: {
                type: "OBJECT",
                properties: {
                    level: { type: "STRING" },
                    role: { type: "STRING" },
                    knowledge: { type: "STRING" },
                    skill: { type: "STRING" },
                    trainingSource: { type: "STRING" },
                    trainingLink: { type: "STRING" },
                    techStack: { type: "STRING" },
                    description: { type: "STRING" },
                    demonstration: { type: "STRING" },
                },
                 required: ["level", "role", "knowledge", "skill", "trainingSource", "trainingLink", "techStack", "description", "demonstration"]
            }
        };

        const generateKSA = async (ability) => {
            toggleLoading(true);
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${userApiKey}`;
            const systemPrompt = `You are 'Cybersecurity KSA Generator'. Your task is to generate a table that breaks down a given Cybersecurity ability by the knowledge and skill a person at a technical level 1 through level 5 should possess.
            - The output MUST be a valid JSON array of 5 objects, one for each technical level (T1, T2, T3, T4, T5).
            - Each object MUST contain these exact keys: "level", "role", "knowledge", "skill", "trainingSource", "trainingLink", "techStack", "description", "demonstration".
            - The "role" should follow the format: "Associate Cybersecurity Analyst" (T1), "Cybersecurity Analyst" (T2), "Principal Cybersecurity Analyst" (T3), "Sr. Principal Cybersecurity Analyst" (T4), "Staff Cybersecurity Analyst" (T5).
            - The content must be professional, concise, and directly related to the provided ability.
            - Do NOT output markdown formatting. The response should be only the raw JSON array.`;

            const payload = {
                contents: [{ parts: [{ text: `Generate a KSA breakdown for the ability: "${ability}"` }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: { responseMimeType: "application/json", responseSchema: ksaSchema },
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(`API error: ${response.status}. Details: ${errorBody.error.message}`);
                }
                const result = await response.json();
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!jsonText) { throw new Error("Received an empty response from the API."); }
                const ksaData = JSON.parse(jsonText);
                displayResults(ability, ksaData);
            } catch (error) {
                console.error('Error generating KSA:', error);
                displayError(error.message);
            } finally {
                toggleLoading(false);
            }
        };
        
        const displayResults = (ability, data) => {
            tableBody.innerHTML = ''; 
            tableTitle.textContent = `KSA Breakdown for: "${ability}"`;
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'bg-gray-800 border-b border-gray-700 hover:bg-gray-600';
                row.innerHTML = `
                    <td class="px-6 py-4">Cybersecurity</td>
                    <td class="px-6 py-4 font-medium text-cyan-400">${item.level}</td>
                    <td class="px-6 py-4">${item.role} - ${ability}</td>
                    <td class="px-6 py-4">${item.knowledge || ''}</td>
                    <td class="px-6 py-4">${item.skill || ''}</td>
                    <td class="px-6 py-4">${item.trainingSource || ''}</td>
                    <td class="px-6 py-4">${item.trainingLink && item.trainingLink !== 'N/A' ? `<a href="${item.trainingLink}" target="_blank" class="text-cyan-400 hover:underline">Link</a>` : 'N/A'}</td>
                    <td class="px-6 py-4">${item.techStack || ''}</td>
                    <td class="px-6 py-4">${item.description || ''}</td>
                    <td class="px-6 py-4">${item.demonstration || ''}</td>
                `;
                tableBody.appendChild(row);
            });
        };

        const displayError = (message) => {
            errorMessage.textContent = message;
        };

        const toggleLoading = (isLoading) => {
            if (isLoading) {
                generateBtn.disabled = true;
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
                noResultsDiv.classList.add('hidden');
                errorContainer.classList.add('hidden');
                tableWrapper.classList.add('hidden');
                mainLoader.classList.remove('hidden');
            } else {
                mainLoader.classList.add('hidden');
                generateBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
                if(tableBody.children.length > 0){
                    tableWrapper.classList.remove('hidden');
                    tableTitle.classList.remove('hidden');
                } else {
                     errorContainer.classList.remove('hidden');
                     noResultsDiv.classList.add('hidden');
                }
            }
        };

        saveKeyBtn.addEventListener('click', () => {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                userApiKey = apiKey;
                apiKeyScreen.classList.add('hidden');
                mainAppScreen.classList.remove('hidden');
                apiKeyError.classList.add('hidden');
            } else {
                apiKeyError.classList.remove('hidden');
            }
        });

        generateBtn.addEventListener('click', () => {
            const ability = abilityInput.value.trim();
            if (ability) {
                tableBody.innerHTML = ''; 
                generateKSA(ability);
            }
        });
        
        abilityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateBtn.click();
            }
        });
    </script>
</body>
</html>

